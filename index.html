<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<style>
body {margin:0px;}
#banner {width:100%;height:48px;font-size:28px;background-color:#fff;font-weight:bold;text-align:center}
#img-link {padding-bottom:40px;width:100%;height:18px;font-size:16px;background-color:#fff;font-weight:bold;text-align:center}
table {width:100%;cursor:default;font-family:arial;font-size:14px}
thead {background-color:#ddd;cursor:pointer}
thead th:hover {background-color:#aaa}
tbody tr:hover {background-color:#eee}
/* avoid cursor selection onclick */
.noselect {
	-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;
    -moz-user-select: none;-ms-user-select: none;user-select: none;
}
</style>
</head>
<body>
<div id="banner">UK Regional Events Viewer</div>
<div id="img-link"><a href="https://lh3.googleusercontent.com/SwGg0QS3INjQqwAj8LaYynVOLXOzq5aLdfmbpE78yC-j5C7Qp-4vrFHTITjL0sykRDCAYZeg3tV6Ffi8544CoT06J9QI2IkT2Xc_vW4a4TKJ5HOkg1vLWFZU5upL=w830">Map image link</a><br><a href="https://docs.google.com/forms/d/e/1FAIpQLSe3mGKbNiIp4Wn9NffZvRwfTGbzslQ1D5c0k7SRw46GaKz1KQ/viewform">Add to this list</a></div>
<table>
	<thead>
		<tr class="noselect">
			<th onclick='reloadTable("name")'>Event Name</th>
			<th onclick='reloadTable("date")'>Date (Y-M-D)</th>
			<th onclick='reloadTable("date")'>Time</th>
			<th onclick='reloadTable("region")'>Region</th>
			<th onclick='reloadTable("city")'>City</th>
			<th onclick='reloadTable("link")'>Link</th>
		</tr>
	</thead>
	<tbody id="data">
	</tbody>
</table>
</body>
<script>
class event {
	constructor() {
		this.name = name;
		this.date = "";
		this.time = "";
		this.region = "";
		this.city = "";
		this.url = "N/A";
	}
}
var eventsArray = [];
var rows = [];
$.getJSON('https://spreadsheets.google.com/feeds/cells/10xnuMJFLxHsutoBZvklS-zCFaL26jsov3msCazrHlxA/1/public/full?alt=json', function(result) {
	var tempRow = [];
	var currentRow = -1;
	for (var i=7;i<result.feed.entry.length;i++) {
		if (result.feed.entry[i].gs$cell.row==currentRow) {
			tempRow.push(result.feed.entry[i].gs$cell.inputValue);
			if (i==result.feed.entry.length-1) {rows.push(tempRow)}
		} else {
			if (tempRow!==[]) {rows.push(tempRow)}
			tempRow = [];
			currentRow=result.feed.entry[i].gs$cell.row;
			tempRow.push(result.feed.entry[i].gs$cell.inputValue);
		}
	}
	for (var i=1;i<rows.length;i++) {
		let objTemp = new event();
		if (rows[i][6]!=="N/A") {
			objTemp.url = "<a href='"+rows[i][6]+"'>Click here</a>";
		}
		objTemp.name = rows[i][1];
		objTemp.date = new Date(Date.parse(rows[i][2]));
		objTemp.time = rows[i][3];
		objTemp.region = rows[i][4];
		objTemp.city = rows[i][5];
		eventsArray.push(objTemp);
		delete objTemp;
	}
	/*for (var i=1;i<rows.length;i++) {
		var link = "N/A";
		if (rows[i][6]!=="N/A") {
			link = "<a href='"+rows[i][6]+"'>Click here</a>";
		}
		var newRow = '<tr><th>'+rows[i][1]+'</th>\
		<th>'+rows[i][2]+'</th>\
		<th>'+rows[i][3]+'</th>\
		<th>'+rows[i][4]+'</th>\
		<th>'+rows[i][5]+'</th>\
		<th>'+link+'</th></tr>'
	$('#data').append(newRow);
	}*/
	reloadTable();
})

function reloadTable(sort) {
	$('#data').html('');
	var sortedArray = [];
	switch(sort) {
		case "date":
			sortedArray = eventsArray.sort(function(a,b){return new Date(b.date) + new Date(a.date)});
			break;
		case "name":
			sortedArray = eventsArray.sort(function(a,b){return a.name - b.name});
			break;
		case "region":
			sortedArray = eventsArray.sort(function(a,b){return a.region - b.region});
			break;
		case "city":
			sortedArray = eventsArray.sort(function(a,b){return a.city - b.city});
			break;
		case "link":
			sortedArray = eventsArray.sort(function(a,b){return a.link - b.link});
			break;
		default:
			sortedArray = eventsArray.sort(function(a,b){return new Date(b.date) - new Date(a.date)});
			break;
	}
	for (var i=0;i<eventsArray.length;i++) {
		console.log(sortedArray[i]);
		addToTable(sortedArray[i]);
	}
}

function addToTable(event) {
	var formattedDate = event.date.getFullYear() + "-" + event.date.getMonth() + "-" + event.date.getDate();
	var newRow = '<tr><th>'+event.name+'</th>\
		<th>'+formattedDate+'</th>\
		<th>'+event.time+'</th>\
		<th>'+event.region+'</th>\
		<th>'+event.city+'</th>\
		<th>'+event.url+'</th></tr>'
	$('#data').append(newRow);
}


</script>
</html>










